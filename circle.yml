machine:
    services:
        - docker
    node:
        version: 5.4.0

test:
    pre:
        - webdriver-manager update
        - webdriver-manager --ignore_ssl start > $CIRCLE_ARTIFACTS/webdriver.log 2>&1:
            background: true
        - node test/google_mock_server/mock_google_server.js > $CIRCLE_ARTIFACTS/mock_google_server.log 2>&1
            background: true
        - npm start > $CIRCLE_ARTIFACTS/server.log 2>&1:
            background: true
        - sleep 5
    override:
        - protractor test/protractor/conf.js --params.screenshot_dir=$CIRCLE_ARTIFACTS > $CIRCLE_ARTIFACTS/protractor.log 2>&1

deployment:
    hub:
        branch: master
        commands:
            - docker info
            - docker build -t $DOCKER_USER/index_cards .
            - docker login -u $DOCKER_USER -p $DOCKER_PASS -e $DOCKER_EMAIL
            - docker push $DOCKER_USER/index_cards
    staging:
        branch: master
        heroku:
            appname: salty-basin-2309
